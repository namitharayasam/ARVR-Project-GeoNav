<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D to 3D Map Transition using MapTiler</title>

    <!-- Load MapLibre GL JS and the MapTiler style -->
    <script src="https://cdn.maptiler.com/maplibre-gl-js/v2.4.0/maplibre-gl.js"></script>
    <link href="https://cdn.maptiler.com/maplibre-gl-js/v2.4.0/maplibre-gl.css" rel="stylesheet" />

    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
        }

        #map2d,
        #map3d {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }

        #map3d {
            display: none;
        }

        /* Initially hidden 3D map */
    </style>
</head>

<body>

    <!-- Divs to hold 2D and 3D maps -->
    <div id="map2d"></div>
    <div id="map3d" style="height: 100%; width: 100%;"></div>

    <script>
        const key = '3abJ3EzNbDZOVrnoMgnT'; // Replace with your MapTiler API key
        const style2D = 'https://api.maptiler.com/maps/streets/style.json'; // 2D style
        const style3D = 'https://api.maptiler.com/maps/streets/style.json'; // 3D style

        // Initialize 2D map using MapLibre GL JS and MapTiler style
        const map2d = new maplibregl.Map({
            container: 'map2D',
            style: `${style2D}?key=${key}`,
            center: [77.58337244021612,12.96964725952364],  // Starting coordinates
            zoom: 8,         // Starting zoom level
        });

        // Initialize 3D map (hidden initially)
        const map3d = new maplibregl.Map({
            container: 'map3d', // ID for 3D map div
            style: `${style3D}?key=${key}`,  // Use MapTiler style for 3D view
            center: [77.53531, 16.97], // Initial 3D center position
            zoom: 16.97,               // Initial zoom for 3D view
            pitch: 60,                 // Set the pitch for 3D (angle to show buildings)
            bearing: 0,                // Set bearing for orientation (no rotation)
        });


        // Switch to 3D map when clicking on the 2D map (Shift key required)
        // Click event listener for map (with Shift key check)
        map2d.on('click', (e) => {
            const { lng, lat } = e.lngLat;

            // Check if the 'Shift' key is pressed during the click
            if (e.originalEvent.shiftKey) {  // This is correct for MapLibre GL JS
                // Show the 3D map and hide the 2D map
                document.getElementById('map3d').style.display = 'block';
                document.getElementById('map2d').style.display = 'none';

                // Fly to the clicked coordinates with 3D details
                map3d.flyTo({
                    center: [lng, lat],    // Fly to the clicked location
                    zoom: 20,              // Close-up view of the street level
                    pitch: 60,             // Angle to show buildings in 3D
                    bearing: 0,            // No rotation of the view
                    essential: true        // Essential flag to prioritize animation
                });
            }
        });


        // Optional: Button to return to 2D map view
        const returnButton = document.createElement('button');
        returnButton.textContent = 'Return to 2D view';
        returnButton.style.position = 'absolute';
        returnButton.style.top = '10px';
        returnButton.style.left = '10px';
        returnButton.style.zIndex = '1';
        returnButton.onclick = () => {
            // Hide 3D map and show 2D map again
            document.getElementById('map2d').style.display = 'block';
            document.getElementById('map3d').style.display = 'none';
        };
        document.body.appendChild(returnButton);
    </script>
</body>

</html>
